<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload/Download Data</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body { padding-top: 70px; } /* Add padding for fixed navbar */
        .container { max-width: 960px; }
        .section-card {
            margin-bottom: 2rem;
            padding: 1.5rem;
            border-radius: 0.5rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0,0,0,0.075);
        }
        textarea {
            min-height: 200px;
            font-family: monospace;
            font-size: 0.9rem;
        }
        .alert-container { margin-top: 1rem; }
        .nav-link { font-weight: 500; }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">FastAPI CRUD App</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Dashboard & Items</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/up-down-data">Upload/Download</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-5">
        <h1 class="mb-4">Data Management</h1>

        <!-- CSV Upload Section -->
        <div class="card section-card">
            <div class="card-body">
                <h2 class="card-title"><i class="bi bi-file-earmark-arrow-up-fill text-primary"></i> Upload CSV</h2>
                <p>Upload item data using a CSV file. Ensure your CSV matches the required format.</p>
                <form id="csvUploadForm" action="/upload/csv" method="post" enctype="multipart/form-data">
                    <div class="mb-3">
                        <label for="csvFile" class="form-label">CSV File</label>
                        <input class="form-control" type="file" id="csvFile" name="file" accept=".csv" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Upload CSV</button>
                    <a href="/download/sample-csv" class="btn btn-outline-secondary ms-2">Download Sample CSV</a>
                </form>
                <div id="csvUploadMessages" class="alert-container"></div>
            </div>
        </div>

        <!-- JSON Upload Section -->
        <div class="card section-card">
            <div class="card-body">
                <h2 class="card-title"><i class="bi bi-code-square text-success"></i> Upload JSON</h2>
                <p>Paste item data in JSON format. See the example structure below.</p>
                <form id="jsonUploadForm" action="/upload/json" method="post">
                    <div class="mb-3">
                        <label for="jsonData" class="form-label">JSON Data</label>
                        <textarea class="form-control" id="jsonData" name="json_data" rows="10" required></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">Upload JSON</button>
                </form>
                <div class="mt-3">
                    <p class="fw-bold">Example JSON Structure (list of items):</p>
                    <pre class="bg-light p-2 rounded"><code>[
  {
    "name": "Sample Item",
    "description": "Description here",
    "price": "10.99",
    "Town Hall Level": "10",
    "King Level": "30",
    "Queen Level": "30",
    "Warden Level": "10",
    "Champion Level": "5",
    "media": {
      "media1": "http://example.com/image1.jpg",
      "media2": "http://example.com/image2.jpg",
      "media3": "http://example.com/image3.jpg"
    }
  },
  { ... more items ... }
]</code></pre>
                </div>
                <div id="jsonUploadMessages" class="alert-container"></div>
            </div>
        </div>

        <!-- Download Data Section -->
        <div class="card section-card">
            <div class="card-body">
                <h2 class="card-title"><i class="bi bi-download text-info"></i> Download All Data</h2>
                <p>Download all items currently in the database.</p>
                <a href="/download/json" class="btn btn-info me-2">Download as JSON</a>
                <a href="/download/csv" class="btn btn-info">Download as CSV</a>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Basic form submission handling for feedback (can be enhanced)
        const csvForm = document.getElementById('csvUploadForm');
        const csvMessages = document.getElementById('csvUploadMessages');
        if (csvForm) {
            csvForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                const formData = new FormData(this);
                const response = await fetch(this.action, { method: 'POST', body: formData });
                const result = await response.json();
                displayMessages(csvMessages, result);
            });
        }

        const jsonForm = document.getElementById('jsonUploadForm');
        const jsonMessages = document.getElementById('jsonUploadMessages');
        if (jsonForm) {
            jsonForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                // For JSON, we need to send it as application/json, not form data
                const jsonData = document.getElementById('jsonData').value;
                try {
                    JSON.parse(jsonData); // Validate if it's actual JSON before sending
                } catch (err) {
                    displayMessages(jsonMessages, { success: false, message: 'Invalid JSON format in text area.', errors: [err.message] });
                    return;
                }
                const response = await fetch(this.action, {
                     method: 'POST',
                     headers: { 'Content-Type': 'application/json' },
                     body: jsonData
                });
                const result = await response.json();
                displayMessages(jsonMessages, result);
            });
        }

        function displayMessages(container, result) {
            container.innerHTML = ''; // Clear previous messages
            const alertType = result.success ? 'alert-success' : 'alert-danger';
            let messageHtml = `<div class="alert ${alertType}" role="alert">${result.message}</div>`;
            if (result.errors && result.errors.length > 0) {
                messageHtml += '<h6>Errors:</h6><ul>';
                result.errors.forEach(err => {
                    messageHtml += `<li>${typeof err === 'object' ? JSON.stringify(err) : err}</li>`;
                });
                messageHtml += '</ul>';
            }
            container.innerHTML = messageHtml;
        }
    </script>
</body>
</html>
